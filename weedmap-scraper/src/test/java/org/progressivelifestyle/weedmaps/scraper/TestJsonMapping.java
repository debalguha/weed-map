package org.progressivelifestyle.weedmaps.scraper;

import static junit.framework.Assert.assertEquals;
import static junit.framework.Assert.assertNotNull;

import java.io.IOException;

import junit.framework.Assert;

import org.junit.Test;
import org.progressivelifestyle.weedmap.persistence.domain.Menu;
import org.progressivelifestyle.weedmaps.objects.MenuItem;
import org.progressivelifestyle.weedmaps.objects.Picture;
import org.progressivelifestyle.weedmaps.objects.PictureImage;

import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;


public class TestJsonMapping {
	@Test
	public void shouldBeAbleToParseJsonIntoPictureImageObject() throws JsonParseException, JsonMappingException, IOException{
		String jsonString = "{	\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/White_Widow.jpg\",	\"leader\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/leader_White_Widow.jpg\"	},	\"large_pad\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/large_pad_White_Widow.jpg\"	},	\"large\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/large_White_Widow.jpg\"	},	\"medium\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_White_Widow.jpg\"	},	\"medium_fill\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_fill_White_Widow.jpg\"	},	\"medium_pad\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_pad_White_Widow.jpg\"	},	\"medium_boxed\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_boxed_White_Widow.jpg\"	},	\"medium_oriented\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_oriented_White_Widow.jpg\"	},	\"square\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/square_White_Widow.jpg\"	},	\"square_fill\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/square_fill_White_Widow.jpg\"	},	\"square_boxed\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/square_boxed_White_Widow.jpg\"	},	\"small_wide\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/small_wide_White_Widow.jpg\"	}}";
		ObjectMapper mapper = new ObjectMapper();
		PictureImage value = mapper.readValue(jsonString, PictureImage.class);
		Assert.assertNotNull(value);
		System.out.println(value.getUrl());
	}
	
	@Test
	public void shouldBeAbleToParseJsonIntoPicture() throws JsonParseException, JsonMappingException, IOException{
		String jsonString = "{	\"approved_by_admin\": false,	\"banned_at\": null,	\"community_post_uuid\": null,	\"created_at\": \"2014-02-11T19:33:11Z\",	\"deleted_at\": null,	\"hits_count\": 0,	\"id\": 407840,	\"image\": {		\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/White_Widow.jpg\",		\"leader\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/leader_White_Widow.jpg\"		},		\"large_pad\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/large_pad_White_Widow.jpg\"		},		\"large\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/large_White_Widow.jpg\"		},		\"medium\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_White_Widow.jpg\"		},		\"medium_fill\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_fill_White_Widow.jpg\"		},		\"medium_pad\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_pad_White_Widow.jpg\"		},		\"medium_boxed\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_boxed_White_Widow.jpg\"		},		\"medium_oriented\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_oriented_White_Widow.jpg\"		},		\"square\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/square_White_Widow.jpg\"		},		\"square_fill\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/square_fill_White_Widow.jpg\"		},		\"square_boxed\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/square_boxed_White_Widow.jpg\"		},		\"small_wide\": {			\"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/small_wide_White_Widow.jpg\"		}	},	\"image_content_type\": null,	\"image_file_name\": null,	\"image_file_size\": null,	\"image_updated_at\": null,	\"name\": null,	\"picturable_id\": 3883759,	\"picturable_type\": \"MenuItem\",	\"position\": 0,	\"reported_count\": 0,	\"reviews_count\": 0,	\"updated_at\": \"2014-02-11T19:33:11Z\",	\"user_id\": 286728}";
		ObjectMapper mapper = new ObjectMapper();
		Picture picture = mapper.readValue(jsonString, Picture.class);
		Assert.assertNotNull(picture);
		Assert.assertEquals(new Long(407840), picture.getPictureId());
		System.out.println(picture.getImage().getUrl());
	}
	
	@Test
	public void shouldBeAbleToParseJsonIntoMenuItem() throws JsonParseException, JsonMappingException, IOException{
		String jsonString = "{    \"body\": \"Sensi Seed, White Widow and White Label\",    \"body_html\": null,    \"created_at\": \"2014-02-06T19:12:55Z\",    \"deleted_at\": null,    \"dispensary_id\": 9158,    \"featured\": false,    \"id\": 3883759,    \"image\": {        \"url\": \"/assets/attachments_missing/menu_items/missing.png\",        \"large\": {            \"url\": \"/assets/attachments_missing/menu_items/large_missing.png\"        },        \"medium\": {            \"url\": \"/assets/attachments_missing/menu_items/medium_missing.png\"        },        \"medium_wide\": {            \"url\": \"/assets/attachments_missing/menu_items/medium_wide_missing.png\"        },        \"medium_oriented\": {            \"url\": \"/assets/attachments_missing/menu_items/medium_oriented_missing.png\"        },        \"square\": {            \"url\": \"/assets/attachments_missing/menu_items/square_missing.png\"        },        \"small_wide\": {            \"url\": \"/assets/attachments_missing/menu_items/small_wide_missing.png\"        },        \"small\": {            \"url\": \"/assets/attachments_missing/menu_items/small_missing.png\"        }    },    \"menu_item_category_id\": 1,    \"name\": \"White Widow\",    \"price_eighth\": 40,    \"price_gram\": 12,    \"price_half_gram\": 0,    \"price_half_ounce\": 100,    \"price_ounce\": 200,    \"price_quarter\": 80,    \"price_unit\": 0,    \"primary_picture_id\": null,    \"published\": true,    \"slug\": \"white-widow\",    \"strain_id\": 95,    \"updated_at\": \"2014-04-09T17:32:05Z\",    \"tested\": false,    \"pictures\": [        {            \"approved_by_admin\": false,            \"banned_at\": null,            \"community_post_uuid\": null,            \"created_at\": \"2014-02-11T19:33:11Z\",            \"deleted_at\": null,            \"hits_count\": 0,            \"id\": 407840,            \"image\": {                \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/White_Widow.jpg\",                \"leader\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/leader_White_Widow.jpg\"                },                \"large_pad\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/large_pad_White_Widow.jpg\"                },                \"large\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/large_White_Widow.jpg\"                },                \"medium\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_White_Widow.jpg\"                },                \"medium_fill\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_fill_White_Widow.jpg\"                },                \"medium_pad\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_pad_White_Widow.jpg\"                },                \"medium_boxed\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_boxed_White_Widow.jpg\"                },                \"medium_oriented\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/medium_oriented_White_Widow.jpg\"                },                \"square\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/square_White_Widow.jpg\"                },                \"square_fill\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/square_fill_White_Widow.jpg\"                },                \"square_boxed\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/square_boxed_White_Widow.jpg\"                },                \"small_wide\": {                    \"url\": \"https://d2kxqxnk1i5o9a.cloudfront.net/uploads/pictures/menu_items/407840/small_wide_White_Widow.jpg\"                }            },            \"image_content_type\": null,            \"image_file_name\": null,            \"image_file_size\": null,            \"image_updated_at\": null,            \"name\": null,            \"picturable_id\": 3883759,            \"picturable_type\": \"MenuItem\",            \"position\": 0,            \"reported_count\": 0,            \"reviews_count\": 0,            \"updated_at\": \"2014-02-11T19:33:11Z\",            \"user_id\": 286728        }    ]}";
		ObjectMapper mapper = new ObjectMapper();
		Menu menuItem = mapper.readValue(jsonString, MenuItem.class);
		assertNotNull(menuItem);
		assertEquals(new Long(3883759), menuItem.getDispensaryId());
		assertEquals(1, ((MenuItem)menuItem).getPictures().size());
		assertEquals("95", menuItem.getStrainId());
		Assert.assertEquals(new Long(407840), ((MenuItem)menuItem).getPictures().iterator().next().getPictureId());
	}
}
